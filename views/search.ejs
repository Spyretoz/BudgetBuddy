<link href="/search.css" rel="stylesheet" type="text/css">
<%- include('./partials/header.ejs') %>
<body>
    <%- include('./partials/nav.ejs') %>
    <!-- <h1>Search Results for: <%= query %></h1>
    <ul>
        <% if (products.length > 0) { %>
            <% products.forEach(product => { %>
                <li><%= product.name %> - $<%= product.price %></li>
            <% }) %>
        <% } else { %>
            <p>No products found.</p>
        <% } %>
    </ul> -->

    <div class="products-container" id="products-container">
		<!-- Categories will be added here dynamically -->
		<h1>Search Results for: <%= query %></h1>
		<section class="index-product" id="index-product">
			

		
		</section>
	</div>
</body>

<script>
	// Fetch products from the server and render them on the page
	async function fetchProducts() {
		try {
			// const response = await fetch(window.location.href +'/products');
			// const products = await response.json();
			const products = <%- JSON.stringify(products).replace(/</g, '\\u003c') %>; // Embed data without HTML entities

			// console.log(products);

			const productsContainer = document.getElementById('index-product');

			
			// // Render categories dynamically
			products.forEach(product => {

				const productDiv = document.createElement('a');
				productDiv.href = window.location.href + "/" + `${product.productid}`;

				productDiv.innerHTML = `
					<img src="${product.imageurl}">
					<h2>${product.name}</h2>
					<div class="price">${product.minprice}</div>
				`;

				productDivBox = productDiv.classList.add('index-product-box');
				productsContainer.appendChild(productDiv);
			});
		} catch (error) {
			console.error('Error fetching products: ', error);
		}
	}

	// Call the function to fetch and display products when the page loads
	fetchProducts();
</script>
</body>
<%- include('./partials/footer.ejs') %>
